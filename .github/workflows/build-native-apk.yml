name: Build Real Native APK with EAS

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ— Checkout code
      uses: actions/checkout@v3
    
    - name: ðŸ— Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: ðŸ— Setup Expo and EAS
      uses: expo/expo-github-action@v8
      with:
        expo-version: latest
        eas-version: latest
        token: ${{ secrets.EXPO_TOKEN }}
    
    - name: ðŸ“¦ Install dependencies
      working-directory: ./mobile-native
      run: npm install
    
    - name: ðŸŽ¨ Generate placeholder assets
      working-directory: ./mobile-native
      run: |
        mkdir -p assets
        # Create simple placeholder icon (1024x1024 purple square)
        convert -size 1024x1024 xc:"#8B5CF6" assets/icon.png || echo "ImageMagick not available, using default"
        cp assets/icon.png assets/adaptive-icon.png 2>/dev/null || true
        # Create splash screen (1284x2778 purple)
        convert -size 1284x2778 xc:"#8B5CF6" assets/splash.png || echo "Using default splash"
        # Create favicon (48x48)
        convert -size 48x48 xc:"#8B5CF6" assets/favicon.png || echo "Using default favicon"
        echo "Assets generated or using defaults"
    
    - name: ðŸš€ Build APK with EAS
      working-directory: ./mobile-native
      run: |
        echo "Building native APK..."
        eas build --platform android --profile preview --non-interactive
    
    - name: ðŸ“± Build Complete
      run: |
        echo "âœ… Native APK build completed!"
        echo "ðŸ“± Download from: https://expo.dev"
        echo "ðŸ”— Login and check your builds"
